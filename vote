package com.logui.arghasen.votingapp;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;

import com.google.firebase.FirebaseApp;
import com.google.firebase.auth.FirebaseAuth;
import com.google.firebase.auth.FirebaseUser;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;

public class vote extends AppCompatActivity implements View.OnClickListener {
    private int option;
    private String username;


    private String apiKey = "AIzaSyAsfes2ImRyAu6aOcAlERZ-BKvzbuQjxYU";
    private String applicationId = "1:684513779261:android:42e1206fb2f300e6741454";
    private String databaseUrl = "https://scheduling-74ad0-default-rtdb.firebaseio.com";

    private DatabaseReference myRef;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_vote);

        // This gets the username from our firebase? I think?
        FirebaseUser currentUser = FirebaseAuth.getInstance().getCurrentUser();

        if (currentUser != null) {
            // if theres an account with that username, itll go through
            username = currentUser.getDisplayName();

            // initialize Firebase
            FirebaseApp.initializeApp(this, new FirebaseOptions.Builder()
                    .setApplicationId(applicationId)
                    .setApiKey(apiKey)
                    .setDatabaseUrl(databaseUrl)
                    .setStorageBucket("scheduling-74ad0.appspot.com")
                    .build());

            // gets the user node from the firebase database
            myRef = FirebaseDatabase.getInstance().getReference("User");

            // Set up click listeners for buttons
            findViewById(R.id.button1).setOnClickListener(this);
            findViewById(R.id.button2).setOnClickListener(this);
            findViewById(R.id.button3).setOnClickListener(this);
            findViewById(R.id.button4).setOnClickListener(this);
        } else {
            // if there isnt a username, it wont let them vote
            disableVotingOptions();
        }
    }

    private void disableVotingOptions() {
        // this is what doesnt let them do anything else basically
        Button button1 = findViewById(R.id.button1);
        Button button2 = findViewById(R.id.button2);
        Button button3 = findViewById(R.id.button3);
        Button button4 = findViewById(R.id.button4);

        button1.setEnabled(false);
        button2.setEnabled(false);
        button3.setEnabled(false);
        button4.setEnabled(false);
    }

    private void databasesend() {
        // this creates a unique key for the user
        String id = myRef.push().getKey();

        // creates a new user object with the username and selected option
        user newuser = new user(username, option);

        // sets the user object in the Firebase Database
        myRef.child(id).setValue(newuser);

    }

    @Override
    public void onClick(View v) {
        // based on the clicked button, itll determine the option 
        switch (v.getId()) {
            case R.id.button1:
                option = 1;
                databasesend();
                break;
            case R.id.button2:
                option = 2;
                databasesend();
                break;
            case R.id.button3:
                option = 3;
                databasesend();
                break;
            case R.id.button4:
                option = 4;
                databasesend();
                break;
        }
    }

    @Override
    public void onBackPressed() {
        // Disable the back button
        return;
    }
}
